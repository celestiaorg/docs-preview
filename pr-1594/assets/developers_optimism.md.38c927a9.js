import{c as o}from"./chunks/constants.dc70dfe7.js";import{o as t,c as p,k as s,t as e,l,a,Q as n}from"./chunks/framework.ccd58aee.js";const c=n(`<h1 id="run-an-op-stack-devnet-posting-celestia" tabindex="-1">Run an OP Stack devnet posting Celestia <a class="header-anchor" href="#run-an-op-stack-devnet-posting-celestia" aria-label="Permalink to &quot;Run an OP Stack devnet posting Celestia&quot;">​</a></h1><p>This guide will show you how to run your own OP Stack devnet locally that posts to a Celestia network.</p><p>If you&#39;d like to use a Rollups as a Service (RaaS) provider, you can visit the RaaS category in the menu.</p><h2 id="dependency-setup" tabindex="-1">Dependency setup <a class="header-anchor" href="#dependency-setup" aria-label="Permalink to &quot;Dependency setup&quot;">​</a></h2><h3 id="environment-setup" tabindex="-1">Environment setup <a class="header-anchor" href="#environment-setup" aria-label="Permalink to &quot;Environment setup&quot;">​</a></h3><p>First, <a href="./../nodes/environment">install dependencies for Celestia software</a> and for <a href="https://community.optimism.io/docs/developers/build/dev-node/" target="_blank" rel="noreferrer">OP Stack</a>.</p><h3 id="clone-repository" tabindex="-1">Clone repository <a class="header-anchor" href="#clone-repository" aria-label="Permalink to &quot;Clone repository&quot;">​</a></h3><p>Next, clone the repo:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">cd</span><span style="color:#E1E4E8;"> $HOME</span></span>
<span class="line"><span style="color:#B392F0;">git</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clone</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://github.com/celestiaorg/optimism</span></span>
<span class="line"><span style="color:#79B8FF;">cd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">optimism</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">cd</span><span style="color:#24292E;"> $HOME</span></span>
<span class="line"><span style="color:#6F42C1;">git</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clone</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://github.com/celestiaorg/optimism</span></span>
<span class="line"><span style="color:#005CC5;">cd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">optimism</span></span></code></pre></div><p>Check out to the version for either the <a href="https://github.com/celestiaorg/optimism/releases" target="_blank" rel="noreferrer">stable version</a> or <a href="https://github.com/celestiaorg/optimism/tree/celestia-develop" target="_blank" rel="noreferrer">upstream version</a>:</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-V70DD" id="tab-DrqcyH3" checked="checked"><label for="tab-DrqcyH3">v1.3.0-OP_op-node/v1.7.7-rc.1-CN_v0.13.2</label><input type="radio" name="group-V70DD" id="tab-g5WHpTz"><label for="tab-g5WHpTz">celestia-develop</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">git</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tags/v1.3.0-OP_op-node/v1.7.7-rc.1-CN_v0.13.2</span></span>
<span class="line"><span style="color:#B392F0;">git</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">submodule</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">update</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--init</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--recursive</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">git</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tags/v1.3.0-OP_op-node/v1.7.7-rc.1-CN_v0.13.2</span></span>
<span class="line"><span style="color:#6F42C1;">git</span><span style="color:#24292E;"> </span><span style="color:#032F62;">submodule</span><span style="color:#24292E;"> </span><span style="color:#032F62;">update</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--init</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--recursive</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">git</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">celestia-develop</span></span>
<span class="line"><span style="color:#B392F0;">git</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">submodule</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">update</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--init</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--recursive</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">git</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">celestia-develop</span></span>
<span class="line"><span style="color:#6F42C1;">git</span><span style="color:#24292E;"> </span><span style="color:#032F62;">submodule</span><span style="color:#24292E;"> </span><span style="color:#032F62;">update</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--init</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--recursive</span></span></code></pre></div></div></div><h2 id="build-devnet" tabindex="-1">Build devnet <a class="header-anchor" href="#build-devnet" aria-label="Permalink to &quot;Build devnet&quot;">​</a></h2><p>Build TypeScript definitions for TS dependencies:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">make</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">make</span></span></code></pre></div><p>Set environment variables to start network:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> SEQUENCER_BATCH_INBOX_ADDRESS</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0xff00000000000000000000000000000000000000</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> L2OO_ADDRESS</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x70997970C51812dc3A010C7d01b50e0d17dc79C8</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> SEQUENCER_BATCH_INBOX_ADDRESS</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0xff00000000000000000000000000000000000000</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> L2OO_ADDRESS</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x70997970C51812dc3A010C7d01b50e0d17dc79C8</span></span></code></pre></div><h2 id="setting-up-your-light-node" tabindex="-1">Setting up your light node <a class="header-anchor" href="#setting-up-your-light-node" aria-label="Permalink to &quot;Setting up your light node&quot;">​</a></h2><p>In order to allow your light node to post and retrieve data without errors, you will need to change <code>UseShareExchange</code> to <code>false</code> in:</p>`,18),r={class:"vp-code-group vp-adaptive-theme"},i=n('<div class="tabs"><input type="radio" name="group-HjVCL" id="tab-wTCwk-Z" checked="checked"><label for="tab-wTCwk-Z">Mainnet Beta</label><input type="radio" name="group-HjVCL" id="tab-x5w-rre"><label for="tab-x5w-rre">Mocha</label><input type="radio" name="group-HjVCL" id="tab-0cGyNn0"><label for="tab-0cGyNn0">Arabica</label></div>',1),d={class:"blocks"},E=n('<div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">$HOME/.celestia-light/config.toml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">$HOME/.celestia-light/config.toml</span></span></code></pre></div>',1),y={class:"language-bash vp-adaptive-theme"},h=s("button",{title:"Copy Code",class:"copy"},null,-1),_=s("span",{class:"lang"},"bash",-1),u={class:"shiki github-dark vp-code-dark"},b={class:"line"},F={style:{color:"#E1E4E8"}},C={class:"shiki github-light vp-code-light"},g={class:"line"},f={style:{color:"#24292E"}},T={class:"language-bash vp-adaptive-theme"},m=s("button",{title:"Copy Code",class:"copy"},null,-1),A=s("span",{class:"lang"},"bash",-1),v={class:"shiki github-dark vp-code-dark"},k={class:"line"},q={style:{color:"#E1E4E8"}},B={class:"shiki github-light vp-code-light"},S={class:"line"},D={style:{color:"#24292E"}},P=n('<p>If you choose to use your own node store, the light node must be <strong>fully synced</strong> and <strong>funded</strong> for you to be able to submit and retrieve <code>PayForBlobs</code> to a Celestia network. Visit the <a href="./../nodes/arabica-devnet">Arabica</a> or <a href="./../nodes/mocha-testnet">Mocha</a> pages to visit their faucets. If it is not synced, you will run into <a href="https://github.com/celestiaorg/celestia-node/issues/2151/" target="_blank" rel="noreferrer">errors similar to this</a>.</p><p>In order to mount existing data, you must have a node store that is in the default directory:</p>',2),I={class:"vp-code-group vp-adaptive-theme"},x=n('<div class="tabs"><input type="radio" name="group-o9xQ-" id="tab-g86ijpp" checked="checked"><label for="tab-g86ijpp">Mainnet Beta</label><input type="radio" name="group-o9xQ-" id="tab-c3l90iR"><label for="tab-c3l90iR">Mocha</label><input type="radio" name="group-o9xQ-" id="tab-G0fT7dd"><label for="tab-G0fT7dd">Arabica</label></div>',1),V={class:"blocks"},N=n('<div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">$HOME/.celestia-light</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">$HOME/.celestia-light</span></span></code></pre></div>',1),w={class:"language-bash vp-adaptive-theme"},O=s("button",{title:"Copy Code",class:"copy"},null,-1),R=s("span",{class:"lang"},"bash",-1),H={class:"shiki github-dark vp-code-dark"},M={class:"line"},$={style:{color:"#E1E4E8"}},L={class:"shiki github-light vp-code-light"},U={class:"line"},G={style:{color:"#24292E"}},j={class:"language-bash vp-adaptive-theme"},Q=s("button",{title:"Copy Code",class:"copy"},null,-1),K=s("span",{class:"lang"},"bash",-1),Y={class:"shiki github-dark vp-code-dark"},W={class:"line"},X={style:{color:"#E1E4E8"}},z={class:"shiki github-light vp-code-light"},Z={class:"line"},J={style:{color:"#24292E"}},ss=n('<p>By default, the node will run with the account named <code>my_celes_key</code>. If you have your own setup you&#39;d like to try, you can always edit <code>optimism/ops-bedrock/docker-compose.yml</code> to work with your setup.</p><h3 id="docker-changes" tabindex="-1">Docker changes <a class="header-anchor" href="#docker-changes" aria-label="Permalink to &quot;Docker changes&quot;">​</a></h3><p>You will need to modify the <code>da:</code> section of your <code>$HOME/optimism/ops-bedrock/docker-compose.yml</code> for your specific use, similarly to the example below. This setup will use <code>celestia-node</code> with a DA server on port 26658.</p><p>For the <code>P2P_NETWORK</code> variable, you&#39;ll need to supply the network of choice, either <code>celestia</code>, <code>mocha</code>, or <code>arabica</code>. Using <code>celestia</code>, the volume path will be just <code>.celestia-light</code> instead of <code>.celestia-light-&lt;network&gt;</code>. You will also need to provide a <code>--core.ip &lt;RPC_URL&gt;</code> for the network you are using.</p>',4),as={class:"vp-code-group vp-adaptive-theme"},ns=n('<div class="tabs"><input type="radio" name="group--p7Zj" id="tab-FIT7b7Y" checked="checked"><label for="tab-FIT7b7Y">Mainnet Beta</label><input type="radio" name="group--p7Zj" id="tab-2oP_46O"><label for="tab-2oP_46O">Mocha testnet</label><input type="radio" name="group--p7Zj" id="tab-zBIM0De"><label for="tab-zBIM0De">Arabica devnet</label></div>',1),os={class:"blocks"},es=n(`<div class="language-yaml vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#85E89D;">da</span><span style="color:#E1E4E8;">:</span></span>
<span class="line diff remove"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ghcr.io/rollkit/local-celestia-devnet:v0.13.1</span><span style="color:#E1E4E8;"> </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ghcr.io/celestiaorg/celestia-node:v0.13.2</span><span style="color:#E1E4E8;"> </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">celestia light start --p2p.network celestia --core.ip rpc.celestia.pops.one --gateway</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">&quot;26658:26658&quot;</span></span>
<span class="line diff add"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">&quot;26659:26659&quot;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">: </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">$HOME/.celestia-light/:/home/celestia/.celestia-light/</span><span style="color:#E1E4E8;"> </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">environment</span><span style="color:#E1E4E8;">: </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">NODE_TYPE</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;light&quot;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">P2P_NETWORK</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;celestia&quot;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">user</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">healthcheck</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">test</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;CMD&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;curl&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;-f&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;http://localhost:26659/header/1&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">10s</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">timeout</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5s</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">retries</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">5</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">start_period</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">30s</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#22863A;">da</span><span style="color:#24292E;">:</span></span>
<span class="line diff remove"><span style="color:#24292E;">  </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ghcr.io/rollkit/local-celestia-devnet:v0.13.1</span><span style="color:#24292E;"> </span></span>
<span class="line diff add"><span style="color:#24292E;">  </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ghcr.io/celestiaorg/celestia-node:v0.13.2</span><span style="color:#24292E;"> </span></span>
<span class="line diff add"><span style="color:#24292E;">  </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: </span><span style="color:#032F62;">celestia light start --p2p.network celestia --core.ip rpc.celestia.pops.one --gateway</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#032F62;">&quot;26658:26658&quot;</span></span>
<span class="line diff add"><span style="color:#24292E;">    - </span><span style="color:#032F62;">&quot;26659:26659&quot;</span><span style="color:#24292E;"> </span></span>
<span class="line diff add"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">: </span></span>
<span class="line diff add"><span style="color:#24292E;">    - </span><span style="color:#032F62;">$HOME/.celestia-light/:/home/celestia/.celestia-light/</span><span style="color:#24292E;"> </span></span>
<span class="line diff add"><span style="color:#24292E;">  </span><span style="color:#22863A;">environment</span><span style="color:#24292E;">: </span></span>
<span class="line diff add"><span style="color:#24292E;">    </span><span style="color:#22863A;">NODE_TYPE</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;light&quot;</span><span style="color:#24292E;"> </span></span>
<span class="line diff add"><span style="color:#24292E;">    </span><span style="color:#22863A;">P2P_NETWORK</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;celestia&quot;</span><span style="color:#24292E;"> </span></span>
<span class="line diff add"><span style="color:#24292E;">  </span><span style="color:#22863A;">user</span><span style="color:#24292E;">: </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">healthcheck</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">test</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;CMD&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;curl&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;-f&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;http://localhost:26659/header/1&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">interval</span><span style="color:#24292E;">: </span><span style="color:#032F62;">10s</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">timeout</span><span style="color:#24292E;">: </span><span style="color:#032F62;">5s</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">retries</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">5</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">start_period</span><span style="color:#24292E;">: </span><span style="color:#032F62;">30s</span></span></code></pre></div>`,1),ls={class:"language-yaml vp-adaptive-theme"},ts=s("button",{title:"Copy Code",class:"copy"},null,-1),ps=s("span",{class:"lang"},"yaml",-1),cs={class:"shiki github-dark has-diff vp-code-dark"},rs=s("span",{class:"line"},[s("span",{style:{color:"#85E89D"}},"da"),s("span",{style:{color:"#E1E4E8"}},":")],-1),is=n('<span class="line diff add"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ghcr.io/celestiaorg/celestia-node:v0.13.2</span><span style="color:#E1E4E8;"> </span></span>',1),ds=n('<span class="line diff add"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">celestia light start --p2p.network mocha --core.ip consensus-full-mocha-4.celestia-mocha.com --gateway</span></span>',1),Es=s("span",{class:"line"},[s("span",{style:{color:"#E1E4E8"}},"  "),s("span",{style:{color:"#85E89D"}},"ports"),s("span",{style:{color:"#E1E4E8"}},":")],-1),ys=s("span",{class:"line"},[s("span",{style:{color:"#E1E4E8"}},"    - "),s("span",{style:{color:"#9ECBFF"}},'"26658:26658"')],-1),hs=s("span",{class:"line diff add"},[s("span",{style:{color:"#E1E4E8"}},"    - "),s("span",{style:{color:"#9ECBFF"}},'"26659:26659"'),s("span",{style:{color:"#E1E4E8"}}," ")],-1),_s=s("span",{class:"line diff add"},[s("span",{style:{color:"#E1E4E8"}},"  "),s("span",{style:{color:"#85E89D"}},"volumes"),s("span",{style:{color:"#E1E4E8"}},": ")],-1),us={class:"line diff add"},bs=s("span",{style:{color:"#E1E4E8"}},"    - ",-1),Fs={style:{color:"#9ECBFF"}},Cs=s("span",{style:{color:"#E1E4E8"}}," ",-1),gs=s("span",{class:"line diff add"},[s("span",{style:{color:"#E1E4E8"}},"  "),s("span",{style:{color:"#85E89D"}},"environment"),s("span",{style:{color:"#E1E4E8"}},": ")],-1),fs=n('<span class="line diff add"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">NODE_TYPE</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;light&quot;</span><span style="color:#E1E4E8;"> </span></span>',1),Ts=n('<span class="line diff add"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">P2P_NETWORK</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;mocha&quot;</span><span style="color:#E1E4E8;"> </span></span>',1),ms=n('<span class="line diff add"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">user</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span></span>',1),As=s("span",{class:"line"},[s("span",{style:{color:"#E1E4E8"}},"  "),s("span",{style:{color:"#85E89D"}},"healthcheck"),s("span",{style:{color:"#E1E4E8"}},":")],-1),vs=n('<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">test</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;CMD&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;curl&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;-f&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;http://localhost:26659/header/1&quot;</span><span style="color:#E1E4E8;">]</span></span>',1),ks=n('<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">10s</span></span>',1),qs=n('<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">timeout</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5s</span></span>',1),Bs=n('<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">retries</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">5</span></span>',1),Ss=n('<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">start_period</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">30s</span></span>',1),Ds={class:"shiki github-light has-diff vp-code-light"},Ps=s("span",{class:"line"},[s("span",{style:{color:"#22863A"}},"da"),s("span",{style:{color:"#24292E"}},":")],-1),Is=n('<span class="line diff add"><span style="color:#24292E;">  </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ghcr.io/celestiaorg/celestia-node:v0.13.2</span><span style="color:#24292E;"> </span></span>',1),xs=n('<span class="line diff add"><span style="color:#24292E;">  </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: </span><span style="color:#032F62;">celestia light start --p2p.network mocha --core.ip consensus-full-mocha-4.celestia-mocha.com --gateway</span></span>',1),Vs=s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"  "),s("span",{style:{color:"#22863A"}},"ports"),s("span",{style:{color:"#24292E"}},":")],-1),Ns=s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    - "),s("span",{style:{color:"#032F62"}},'"26658:26658"')],-1),ws=s("span",{class:"line diff add"},[s("span",{style:{color:"#24292E"}},"    - "),s("span",{style:{color:"#032F62"}},'"26659:26659"'),s("span",{style:{color:"#24292E"}}," ")],-1),Os=s("span",{class:"line diff add"},[s("span",{style:{color:"#24292E"}},"  "),s("span",{style:{color:"#22863A"}},"volumes"),s("span",{style:{color:"#24292E"}},": ")],-1),Rs={class:"line diff add"},Hs=s("span",{style:{color:"#24292E"}},"    - ",-1),Ms={style:{color:"#032F62"}},$s=s("span",{style:{color:"#24292E"}}," ",-1),Ls=s("span",{class:"line diff add"},[s("span",{style:{color:"#24292E"}},"  "),s("span",{style:{color:"#22863A"}},"environment"),s("span",{style:{color:"#24292E"}},": ")],-1),Us=n('<span class="line diff add"><span style="color:#24292E;">    </span><span style="color:#22863A;">NODE_TYPE</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;light&quot;</span><span style="color:#24292E;"> </span></span>',1),Gs=n('<span class="line diff add"><span style="color:#24292E;">    </span><span style="color:#22863A;">P2P_NETWORK</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;mocha&quot;</span><span style="color:#24292E;"> </span></span>',1),js=n('<span class="line diff add"><span style="color:#24292E;">  </span><span style="color:#22863A;">user</span><span style="color:#24292E;">: </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span></span>',1),Qs=s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"  "),s("span",{style:{color:"#22863A"}},"healthcheck"),s("span",{style:{color:"#24292E"}},":")],-1),Ks=n('<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">test</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;CMD&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;curl&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;-f&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;http://localhost:26659/header/1&quot;</span><span style="color:#24292E;">]</span></span>',1),Ys=n('<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">interval</span><span style="color:#24292E;">: </span><span style="color:#032F62;">10s</span></span>',1),Ws=n('<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">timeout</span><span style="color:#24292E;">: </span><span style="color:#032F62;">5s</span></span>',1),Xs=n('<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">retries</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">5</span></span>',1),zs=n('<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">start_period</span><span style="color:#24292E;">: </span><span style="color:#032F62;">30s</span></span>',1),Zs={class:"language-yaml vp-adaptive-theme"},Js=s("button",{title:"Copy Code",class:"copy"},null,-1),sa=s("span",{class:"lang"},"yaml",-1),aa={class:"shiki github-dark has-diff vp-code-dark"},na=s("span",{class:"line"},[s("span",{style:{color:"#85E89D"}},"da"),s("span",{style:{color:"#E1E4E8"}},":")],-1),oa=n('<span class="line diff remove"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ghcr.io/rollkit/local-celestia-devnet:v0.13.1</span><span style="color:#E1E4E8;"> </span></span>',1),ea=n('<span class="line diff add"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ghcr.io/celestiaorg/celestia-node:v0.13.2</span><span style="color:#E1E4E8;"> </span></span>',1),la=n('<span class="line diff add"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">celestia light start --p2p.network arabica --core.ip validator-1.celestia-arabica-11.com --gateway</span></span>',1),ta=s("span",{class:"line"},[s("span",{style:{color:"#E1E4E8"}},"  "),s("span",{style:{color:"#85E89D"}},"ports"),s("span",{style:{color:"#E1E4E8"}},":")],-1),pa=s("span",{class:"line"},[s("span",{style:{color:"#E1E4E8"}},"    - "),s("span",{style:{color:"#9ECBFF"}},'"26658:26658"')],-1),ca=s("span",{class:"line diff add"},[s("span",{style:{color:"#E1E4E8"}},"    - "),s("span",{style:{color:"#9ECBFF"}},'"26659:26659"'),s("span",{style:{color:"#E1E4E8"}}," ")],-1),ra=s("span",{class:"line diff add"},[s("span",{style:{color:"#E1E4E8"}},"  "),s("span",{style:{color:"#85E89D"}},"volumes"),s("span",{style:{color:"#E1E4E8"}},": ")],-1),ia={class:"line diff add"},da=s("span",{style:{color:"#E1E4E8"}},"    - ",-1),Ea={style:{color:"#9ECBFF"}},ya=s("span",{style:{color:"#E1E4E8"}}," ",-1),ha=s("span",{class:"line diff add"},[s("span",{style:{color:"#E1E4E8"}},"  "),s("span",{style:{color:"#85E89D"}},"environment"),s("span",{style:{color:"#E1E4E8"}},": ")],-1),_a=n('<span class="line diff add"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">NODE_TYPE</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;light&quot;</span><span style="color:#E1E4E8;"> </span></span>',1),ua=n('<span class="line diff add"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">P2P_NETWORK</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;arabica&quot;</span><span style="color:#E1E4E8;"> </span></span>',1),ba=n('<span class="line diff add"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">user</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span></span>',1),Fa=s("span",{class:"line"},[s("span",{style:{color:"#E1E4E8"}},"  "),s("span",{style:{color:"#85E89D"}},"healthcheck"),s("span",{style:{color:"#E1E4E8"}},":")],-1),Ca=n('<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">test</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;CMD&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;curl&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;-f&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;http://localhost:26659/header/1&quot;</span><span style="color:#E1E4E8;">]</span></span>',1),ga=n('<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">10s</span></span>',1),fa=n('<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">timeout</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5s</span></span>',1),Ta=n('<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">retries</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">5</span></span>',1),ma=n('<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">start_period</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">30s</span></span>',1),Aa={class:"shiki github-light has-diff vp-code-light"},va=s("span",{class:"line"},[s("span",{style:{color:"#22863A"}},"da"),s("span",{style:{color:"#24292E"}},":")],-1),ka=n('<span class="line diff remove"><span style="color:#24292E;">  </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ghcr.io/rollkit/local-celestia-devnet:v0.13.1</span><span style="color:#24292E;"> </span></span>',1),qa=n('<span class="line diff add"><span style="color:#24292E;">  </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ghcr.io/celestiaorg/celestia-node:v0.13.2</span><span style="color:#24292E;"> </span></span>',1),Ba=n('<span class="line diff add"><span style="color:#24292E;">  </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: </span><span style="color:#032F62;">celestia light start --p2p.network arabica --core.ip validator-1.celestia-arabica-11.com --gateway</span></span>',1),Sa=s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"  "),s("span",{style:{color:"#22863A"}},"ports"),s("span",{style:{color:"#24292E"}},":")],-1),Da=s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    - "),s("span",{style:{color:"#032F62"}},'"26658:26658"')],-1),Pa=s("span",{class:"line diff add"},[s("span",{style:{color:"#24292E"}},"    - "),s("span",{style:{color:"#032F62"}},'"26659:26659"'),s("span",{style:{color:"#24292E"}}," ")],-1),Ia=s("span",{class:"line diff add"},[s("span",{style:{color:"#24292E"}},"  "),s("span",{style:{color:"#22863A"}},"volumes"),s("span",{style:{color:"#24292E"}},": ")],-1),xa={class:"line diff add"},Va=s("span",{style:{color:"#24292E"}},"    - ",-1),Na={style:{color:"#032F62"}},wa=s("span",{style:{color:"#24292E"}}," ",-1),Oa=s("span",{class:"line diff add"},[s("span",{style:{color:"#24292E"}},"  "),s("span",{style:{color:"#22863A"}},"environment"),s("span",{style:{color:"#24292E"}},": ")],-1),Ra=n('<span class="line diff add"><span style="color:#24292E;">    </span><span style="color:#22863A;">NODE_TYPE</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;light&quot;</span><span style="color:#24292E;"> </span></span>',1),Ha=n('<span class="line diff add"><span style="color:#24292E;">    </span><span style="color:#22863A;">P2P_NETWORK</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;arabica&quot;</span><span style="color:#24292E;"> </span></span>',1),Ma=n('<span class="line diff add"><span style="color:#24292E;">  </span><span style="color:#22863A;">user</span><span style="color:#24292E;">: </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span></span>',1),$a=s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"  "),s("span",{style:{color:"#22863A"}},"healthcheck"),s("span",{style:{color:"#24292E"}},":")],-1),La=n('<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">test</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;CMD&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;curl&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;-f&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;http://localhost:26659/header/1&quot;</span><span style="color:#24292E;">]</span></span>',1),Ua=n('<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">interval</span><span style="color:#24292E;">: </span><span style="color:#032F62;">10s</span></span>',1),Ga=n('<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">timeout</span><span style="color:#24292E;">: </span><span style="color:#032F62;">5s</span></span>',1),ja=n('<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">retries</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">5</span></span>',1),Qa=n('<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">start_period</span><span style="color:#24292E;">: </span><span style="color:#032F62;">30s</span></span>',1),Ka=n(`<h3 id="set-your-celestia-node-auth-token" tabindex="-1">Set your Celestia node auth token <a class="header-anchor" href="#set-your-celestia-node-auth-token" aria-label="Permalink to &quot;Set your Celestia node auth token&quot;">​</a></h3><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-WSxmH" id="tab-xFOV4KP" checked="checked"><label for="tab-xFOV4KP">Mainnet Beta</label><input type="radio" name="group-WSxmH" id="tab-QAMXLeJ"><label for="tab-QAMXLeJ">Mocha testnet</label><input type="radio" name="group-WSxmH" id="tab-ZKyMna6"><label for="tab-ZKyMna6">Arabica devnet</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> CELESTIA_NODE_AUTH_TOKEN</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">celestia</span><span style="color:#9ECBFF;"> light auth admin)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> CELESTIA_NODE_AUTH_TOKEN</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">celestia</span><span style="color:#032F62;"> light auth admin)</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> CELESTIA_NODE_AUTH_TOKEN</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">celestia</span><span style="color:#9ECBFF;"> light auth admin </span><span style="color:#79B8FF;">--p2p.network</span><span style="color:#9ECBFF;"> mocha)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> CELESTIA_NODE_AUTH_TOKEN</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">celestia</span><span style="color:#032F62;"> light auth admin </span><span style="color:#005CC5;">--p2p.network</span><span style="color:#032F62;"> mocha)</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> CELESTIA_NODE_AUTH_TOKEN</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">celestia</span><span style="color:#9ECBFF;"> light auth admin </span><span style="color:#79B8FF;">--p2p.network</span><span style="color:#9ECBFF;"> arabica)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> CELESTIA_NODE_AUTH_TOKEN</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">celestia</span><span style="color:#032F62;"> light auth admin </span><span style="color:#005CC5;">--p2p.network</span><span style="color:#032F62;"> arabica)</span></span></code></pre></div></div></div><p>Now you&#39;re ready to start your devnet.</p><h2 id="start-devnet" tabindex="-1">Start devnet <a class="header-anchor" href="#start-devnet" aria-label="Permalink to &quot;Start devnet&quot;">​</a></h2><p>Start the network by running:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">devnet-up</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#032F62;">devnet-up</span></span></code></pre></div><p>This starts up the layer 1 (ETH), layer 2 (<code>op-geth</code>), data availability layer (Celestia), the sequencer (<code>op-node</code>), batch submitter (<code>op-batcher</code>), state commitment service (<code>op-proposer</code>).</p><h3 id="view-the-logs-of-the-devnet" tabindex="-1">View the logs of the devnet <a class="header-anchor" href="#view-the-logs-of-the-devnet" aria-label="Permalink to &quot;View the logs of the devnet&quot;">​</a></h3><p>If you&#39;d like to view the logs of the devnet, run the following command from the root of the Optimism directory:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">devnet-logs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#032F62;">devnet-logs</span></span></code></pre></div><h3 id="optional-stop-devnet" tabindex="-1">Optional: Stop devnet <a class="header-anchor" href="#optional-stop-devnet" aria-label="Permalink to &quot;Optional: Stop devnet&quot;">​</a></h3><p>If you&#39;d like to start the network over, use the following command to safely shut down all of the containers:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">devnet-down</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#032F62;">devnet-down</span></span></code></pre></div><p>Then clean out the old config:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">devnet-clean</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#032F62;">devnet-clean</span></span></code></pre></div><h2 id="deploying-to-an-l1-or-l2" tabindex="-1">Deploying to an L1 (or L2) <a class="header-anchor" href="#deploying-to-an-l1-or-l2" aria-label="Permalink to &quot;Deploying to an L1 (or L2)&quot;">​</a></h2><p>If you&#39;d like to deploy to an EVM L1 or L2, reference the <a href="https://community.optimism.io/docs/developers/bedrock/node-operator-guide/" target="_blank" rel="noreferrer">OP stack deployment guide</a>.</p><h2 id="find-a-transaction" tabindex="-1">Find a transaction <a class="header-anchor" href="#find-a-transaction" aria-label="Permalink to &quot;Find a transaction&quot;">​</a></h2><p>Now, we&#39;ll check for a recent transaction on the L1 with:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cast</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">block</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">latest</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--rpc-url</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:8545</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cast</span><span style="color:#24292E;"> </span><span style="color:#032F62;">block</span><span style="color:#24292E;"> </span><span style="color:#032F62;">latest</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--rpc-url</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:8545</span></span></code></pre></div><p>Output of a block that contains a transaction will look like this:</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">baseFeePerGas        7</span></span>
<span class="line"><span style="color:#79B8FF;">difficulty           2</span></span>
<span class="line"><span style="color:#79B8FF;">extraData            0xd883010d04846765746888676f312e32312e33856c696e7578000000000000006b3afa42dce1f87f1f07a1ef569c4d43e41738ef93c865098bfa1458645f384e2e4498bcfe4ad9353ff1913a2e16162f496fafe5b0939a6c78fb5b503248d6da01</span></span>
<span class="line"><span style="color:#79B8FF;">gasLimit             30000000</span></span>
<span class="line"><span style="color:#79B8FF;">gasUsed              21568</span></span>
<span class="line"><span style="color:#79B8FF;">hash                 0x1cb54d2369752ef73511c202ff9cdfd0eadf3a77b7aef0092bea63f2b5d57659</span></span>
<span class="line"><span style="color:#79B8FF;">logsBloom            0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span>
<span class="line"><span style="color:#79B8FF;">miner                0x0000000000000000000000000000000000000000</span></span>
<span class="line"><span style="color:#79B8FF;">mixHash              0x0000000000000000000000000000000000000000000000000000000000000000</span></span>
<span class="line"><span style="color:#79B8FF;">nonce                0x0000000000000000</span></span>
<span class="line"><span style="color:#79B8FF;">number               1141</span></span>
<span class="line"><span style="color:#79B8FF;">parentHash           0x664bf4bb4a57dd5768a0a98991d77c58fb7a4e164c2581c79fb33ce9c3d4c250</span></span>
<span class="line"><span style="color:#79B8FF;">receiptsRoot         0xaf8ff6af1180c8be9e4e8f3a5f882b3b227233f4abbefa479836d3721682a389</span></span>
<span class="line"><span style="color:#79B8FF;">sealFields           []</span></span>
<span class="line"><span style="color:#79B8FF;">sha3Uncles           0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347</span></span>
<span class="line"><span style="color:#79B8FF;">size                 767</span></span>
<span class="line"><span style="color:#79B8FF;">stateRoot            0xd4b998a35d20d98ed3488221f0c161a0a9572d3de66399482553c8e3d2fae751</span></span>
<span class="line"><span style="color:#79B8FF;">timestamp            1699638350</span></span>
<span class="line"><span style="color:#79B8FF;">withdrawalsRoot</span></span>
<span class="line"><span style="color:#79B8FF;">totalDifficulty      2283</span></span>
<span class="line"><span style="color:#79B8FF;">transactions:        [</span></span>
<span class="line"><span style="color:#79B8FF;">  0x79a0a7a1b4936aafe7a37dbfb07a6a9e55c145a4ed6fd54f962649b4b7db8de7</span></span>
<span class="line"><span style="color:#79B8FF;">]</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#005CC5;">baseFeePerGas        7</span></span>
<span class="line"><span style="color:#005CC5;">difficulty           2</span></span>
<span class="line"><span style="color:#005CC5;">extraData            0xd883010d04846765746888676f312e32312e33856c696e7578000000000000006b3afa42dce1f87f1f07a1ef569c4d43e41738ef93c865098bfa1458645f384e2e4498bcfe4ad9353ff1913a2e16162f496fafe5b0939a6c78fb5b503248d6da01</span></span>
<span class="line"><span style="color:#005CC5;">gasLimit             30000000</span></span>
<span class="line"><span style="color:#005CC5;">gasUsed              21568</span></span>
<span class="line"><span style="color:#005CC5;">hash                 0x1cb54d2369752ef73511c202ff9cdfd0eadf3a77b7aef0092bea63f2b5d57659</span></span>
<span class="line"><span style="color:#005CC5;">logsBloom            0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span>
<span class="line"><span style="color:#005CC5;">miner                0x0000000000000000000000000000000000000000</span></span>
<span class="line"><span style="color:#005CC5;">mixHash              0x0000000000000000000000000000000000000000000000000000000000000000</span></span>
<span class="line"><span style="color:#005CC5;">nonce                0x0000000000000000</span></span>
<span class="line"><span style="color:#005CC5;">number               1141</span></span>
<span class="line"><span style="color:#005CC5;">parentHash           0x664bf4bb4a57dd5768a0a98991d77c58fb7a4e164c2581c79fb33ce9c3d4c250</span></span>
<span class="line"><span style="color:#005CC5;">receiptsRoot         0xaf8ff6af1180c8be9e4e8f3a5f882b3b227233f4abbefa479836d3721682a389</span></span>
<span class="line"><span style="color:#005CC5;">sealFields           []</span></span>
<span class="line"><span style="color:#005CC5;">sha3Uncles           0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347</span></span>
<span class="line"><span style="color:#005CC5;">size                 767</span></span>
<span class="line"><span style="color:#005CC5;">stateRoot            0xd4b998a35d20d98ed3488221f0c161a0a9572d3de66399482553c8e3d2fae751</span></span>
<span class="line"><span style="color:#005CC5;">timestamp            1699638350</span></span>
<span class="line"><span style="color:#005CC5;">withdrawalsRoot</span></span>
<span class="line"><span style="color:#005CC5;">totalDifficulty      2283</span></span>
<span class="line"><span style="color:#005CC5;">transactions:        [</span></span>
<span class="line"><span style="color:#005CC5;">  0x79a0a7a1b4936aafe7a37dbfb07a6a9e55c145a4ed6fd54f962649b4b7db8de7</span></span>
<span class="line"><span style="color:#005CC5;">]</span></span></code></pre></div><p>Copy the transaction hash from <code>transactions: &lt;transaction-hash&gt;</code> and set it as a variable:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> TX_HASH</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x79a0a7a1b4936aafe7a37dbfb07a6a9e55c145a4ed6fd54f962649b4b7db8de7</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> TX_HASH</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x79a0a7a1b4936aafe7a37dbfb07a6a9e55c145a4ed6fd54f962649b4b7db8de7</span></span></code></pre></div><h2 id="read-the-transaction-call-data" tabindex="-1">Read the transaction call data <a class="header-anchor" href="#read-the-transaction-call-data" aria-label="Permalink to &quot;Read the transaction call data&quot;">​</a></h2><p>Now read the transaction call data on the L1:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cast</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tx</span><span style="color:#E1E4E8;"> $TX_HASH </span><span style="color:#79B8FF;">--rpc-url</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:8545</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cast</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tx</span><span style="color:#24292E;"> $TX_HASH </span><span style="color:#005CC5;">--rpc-url</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:8545</span></span></code></pre></div><p>The output will look similar to below:</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">blockHash            0x9f4dfae061b5ddd86f95a81be5daa0d7fe32e7f7f770f86dc375e0007d249bd2</span></span>
<span class="line"><span style="color:#79B8FF;">blockNumber          24</span></span>
<span class="line"><span style="color:#79B8FF;">from                 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC</span></span>
<span class="line"><span style="color:#79B8FF;">gas                  21572</span></span>
<span class="line"><span style="color:#79B8FF;">gasPrice             1040676758</span></span>
<span class="line"><span style="color:#79B8FF;">hash                 0xadd3a5dc0b8c605aeac891098e87cbaff43bb642896ebbf74f964c0690e46df2</span></span>
<span class="line"><span style="color:#79B8FF;">input                0xce3500000000000000769074a923011bdda721eacc34c8a77c69c10f2b6c8e659f987e82f217a5340f</span></span>
<span class="line"><span style="color:#79B8FF;">nonce                4</span></span>
<span class="line"><span style="color:#79B8FF;">r                    0xaf5c1505c7dfcebca94d9a6a8c0caf99b6c87a8ed6d6c0b3161c9026f270a84f</span></span>
<span class="line"><span style="color:#79B8FF;">s                    0x383ed2debf9f9055920cd7340418dda7e2bca6b989eb6992d83d123d4e322f2a</span></span>
<span class="line"><span style="color:#79B8FF;">to                   0xFf00000000000000000000000000000000000901</span></span>
<span class="line"><span style="color:#79B8FF;">transactionIndex     0</span></span>
<span class="line"><span style="color:#79B8FF;">v                    0</span></span>
<span class="line"><span style="color:#79B8FF;">value                0</span></span>
<span class="line"><span style="color:#79B8FF;">yParity              0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">blockHash            0x9f4dfae061b5ddd86f95a81be5daa0d7fe32e7f7f770f86dc375e0007d249bd2</span></span>
<span class="line"><span style="color:#005CC5;">blockNumber          24</span></span>
<span class="line"><span style="color:#005CC5;">from                 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC</span></span>
<span class="line"><span style="color:#005CC5;">gas                  21572</span></span>
<span class="line"><span style="color:#005CC5;">gasPrice             1040676758</span></span>
<span class="line"><span style="color:#005CC5;">hash                 0xadd3a5dc0b8c605aeac891098e87cbaff43bb642896ebbf74f964c0690e46df2</span></span>
<span class="line"><span style="color:#005CC5;">input                0xce3500000000000000769074a923011bdda721eacc34c8a77c69c10f2b6c8e659f987e82f217a5340f</span></span>
<span class="line"><span style="color:#005CC5;">nonce                4</span></span>
<span class="line"><span style="color:#005CC5;">r                    0xaf5c1505c7dfcebca94d9a6a8c0caf99b6c87a8ed6d6c0b3161c9026f270a84f</span></span>
<span class="line"><span style="color:#005CC5;">s                    0x383ed2debf9f9055920cd7340418dda7e2bca6b989eb6992d83d123d4e322f2a</span></span>
<span class="line"><span style="color:#005CC5;">to                   0xFf00000000000000000000000000000000000901</span></span>
<span class="line"><span style="color:#005CC5;">transactionIndex     0</span></span>
<span class="line"><span style="color:#005CC5;">v                    0</span></span>
<span class="line"><span style="color:#005CC5;">value                0</span></span>
<span class="line"><span style="color:#005CC5;">yParity              0</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>You are looking for a batcher transaction to the address <code>0xFf00000000000000000000000000000000000901</code>.</p></div><p>First, remove the prefix <code>0xce</code>. Now, set the <code>input</code> as the <code>INPUT</code> variable and encode it as base64:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> INPUT</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">3500000000000000769074</span><span style="color:#9ECBFF;">a923011bdda721eacc34c8a77c69c10f2b6c8e659f987e82f217a5340f</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> ENCODED_INPUT</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#79B8FF;">echo</span><span style="color:#9ECBFF;"> &quot;</span><span style="color:#E1E4E8;">$INPUT</span><span style="color:#9ECBFF;">&quot; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">xxd</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-r</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#9ECBFF;"> </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">base64</span><span style="color:#9ECBFF;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> INPUT</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">3500000000000000769074</span><span style="color:#032F62;">a923011bdda721eacc34c8a77c69c10f2b6c8e659f987e82f217a5340f</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> ENCODED_INPUT</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#005CC5;">echo</span><span style="color:#032F62;"> &quot;</span><span style="color:#24292E;">$INPUT</span><span style="color:#032F62;">&quot; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">xxd</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-r</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-p</span><span style="color:#032F62;"> </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">base64</span><span style="color:#032F62;">)</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Remember to remove the <code>0xce</code> prefix!</p></div><h2 id="find-the-data-on-celestia" tabindex="-1">Find the data on Celestia <a class="header-anchor" href="#find-the-data-on-celestia" aria-label="Permalink to &quot;Find the data on Celestia&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-X</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">POST</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Content-Type: application/json&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Authorization: Bearer </span><span style="color:#E1E4E8;">$CELESTIA_NODE_AUTH_TOKEN</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{ &quot;id&quot;: 1, &quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;da.Get&quot;, &quot;params&quot;: [[&quot;$ENCODED_INPUT&quot;], &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAECAwQFBgcICRA=&quot;]}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://127.0.0.1:26658</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-s</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-X</span><span style="color:#24292E;"> </span><span style="color:#032F62;">POST</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-H</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Content-Type: application/json&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-H</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Authorization: Bearer </span><span style="color:#24292E;">$CELESTIA_NODE_AUTH_TOKEN</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{ &quot;id&quot;: 1, &quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;da.Get&quot;, &quot;params&quot;: [[&quot;$ENCODED_INPUT&quot;], &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAECAwQFBgcICRA=&quot;]}&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://127.0.0.1:26658</span></span></code></pre></div><p>The params are <code>[]blobs, namespace</code>, base64-encoded.</p><p>Your result will look similar to the below!</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:[&quot;SGVsbG8gd28ybGQh&quot;],&quot;id&quot;:1}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:[&quot;SGVsbG8gd28ybGQh&quot;],&quot;id&quot;:1}</span></span></code></pre></div><h2 id="ethereum-fallback-mechanism-in-op-stack" tabindex="-1">Ethereum fallback mechanism in OP Stack <a class="header-anchor" href="#ethereum-fallback-mechanism-in-op-stack" aria-label="Permalink to &quot;Ethereum fallback mechanism in OP Stack&quot;">​</a></h2><p>The <a href="./ethereum-fallback">Ethereum fallback mechanism</a> allows rollups to &quot;fall back&quot; to Ethereum or another EVM chain in the case of downtime or errors submitting data to Celestia.</p><h3 id="implementation-of-fallback" tabindex="-1">Implementation of fallback <a class="header-anchor" href="#implementation-of-fallback" aria-label="Permalink to &quot;Implementation of fallback&quot;">​</a></h3><p>The Ethereum fallback mechanism is implemented in the <a href="https://github.com/celestiaorg/optimism/tree/release-v1.1.0" target="_blank" rel="noreferrer">celestiaorg/optimism</a> v1.1.0 release.</p><p>The <code>op-batcher/batcher/driver.go</code> and <code>op-node/rollup/derive/calldata_source.go</code> files are part of the Ethereum fallback mechanism in the <code>op-batcher</code> and <code>op-node</code> respectively.</p><p>In <a href="https://github.com/celestiaorg/optimism/blob/release-v1.1.0/op-batcher/batcher/driver.go#L405-L419" target="_blank" rel="noreferrer"><code>driver.go</code>, the <code>calldataTxCandidate</code> function is responsible for the write path</a> of the Ethereum fallback. This function creates and submits a transaction to the batch inbox address with the given data. It uses the underlying <code>txmgr</code> to handle transaction sending and gas price management.</p><p>If the transaction data can be published as a blob to Celestia, it replaces the calldata with a blob identifier and sends the transaction with this data. If it cannot be published to Celestia, it falls back to Ethereum without any change to the transaction.</p><p>The blob identifier starts with the special prefix <code>0xce</code>, which was chosen as a mnemonic for Celestia, and indicates that the remaining data has to interpreted as a little-endian encoded Block Height (8 bytes) and Blob Commitment (32 bytes). The combination of these can later be used to retrieve the original calldata from Celestia.</p><table><thead><tr><th>Prefix</th><th>8 bytes</th><th>32 bytes</th></tr></thead><tbody><tr><td>0xce</td><td>Block Height</td><td>Blob Commitment</td></tr></tbody></table><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">func</span><span style="color:#E1E4E8;"> (l </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">BatchSubmitter) </span><span style="color:#B392F0;">sendTransaction</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    txdata txData,</span></span>
<span class="line"><span style="color:#E1E4E8;">    queue </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">txmgr.Queue[txData],</span></span>
<span class="line"><span style="color:#E1E4E8;">    receiptsCh </span><span style="color:#F97583;">chan</span><span style="color:#E1E4E8;"> txmgr.TxReceipt[txData],</span></span>
<span class="line"><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">func</span><span style="color:#24292E;"> (l </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">BatchSubmitter) </span><span style="color:#6F42C1;">sendTransaction</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    txdata txData,</span></span>
<span class="line"><span style="color:#24292E;">    queue </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">txmgr.Queue[txData],</span></span>
<span class="line"><span style="color:#24292E;">    receiptsCh </span><span style="color:#D73A49;">chan</span><span style="color:#24292E;"> txmgr.TxReceipt[txData],</span></span>
<span class="line"><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>In <code>calldata_source.go</code>, <a href="https://github.com/celestiaorg/optimism/blob/release-v1.1.0/op-node/rollup/derive/calldata_source.go#L102-L139" target="_blank" rel="noreferrer">the <code>DataFromEVMTransactions</code> function defines the read path</a> of the Ethereum fallback. This function filters all of the transactions and returns the calldata from transactions that are sent to the batch inbox address from the batch sender address.</p><p>If the calldata matches the version prefix <code>0xce</code>, it is decoded as a blob identifier, the original calldata is retrieved from Celestia and returned for derivation. If the calldata does not match the prefix, the entire calldata is returned for derivation.</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">func</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DataFromEVMTransactions</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    config </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">rollup.Config,</span></span>
<span class="line"><span style="color:#E1E4E8;">    batcherAddr common.Address,</span></span>
<span class="line"><span style="color:#E1E4E8;">    txs types.Transactions,</span></span>
<span class="line"><span style="color:#E1E4E8;">    log log.Logger</span></span>
<span class="line"><span style="color:#E1E4E8;">) ([]eth.Data, </span><span style="color:#F97583;">error</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">func</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DataFromEVMTransactions</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    config </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">rollup.Config,</span></span>
<span class="line"><span style="color:#24292E;">    batcherAddr common.Address,</span></span>
<span class="line"><span style="color:#24292E;">    txs types.Transactions,</span></span>
<span class="line"><span style="color:#24292E;">    log log.Logger</span></span>
<span class="line"><span style="color:#24292E;">) ([]eth.Data, </span><span style="color:#D73A49;">error</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>These two functions work together to ensure that the Ethereum fallback mechanism operates correctly, allowing the rollup to continue functioning even during periods of downtime on Celestia.</p><h3 id="testing-the-fallback" tabindex="-1">Testing the fallback <a class="header-anchor" href="#testing-the-fallback" aria-label="Permalink to &quot;Testing the fallback&quot;">​</a></h3><p>Testing out the Ethereum fallback mechanism can be done with a curl command. Triggering a simultaneous blob transaction will cause the <code>op-batcher</code> blob transaction to fail, with an <code>incorrect account sequence</code> error, which triggers a fallback to Ethereum.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-X</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">POST</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Content-Type: application/json&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Authorization: Bearer </span><span style="color:#E1E4E8;">$CELESTIA_NODE_AUTH_TOKEN</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{ &quot;id&quot;: 1, &quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;da.Submit&quot;, &quot;params&quot;: [[&quot;SGVsbG8gd28ybGQh&quot;], -1, &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAECAwQFBgcICRA=&quot;]}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://127.0.0.1:26658</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-s</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-X</span><span style="color:#24292E;"> </span><span style="color:#032F62;">POST</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-H</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Content-Type: application/json&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-H</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Authorization: Bearer </span><span style="color:#24292E;">$CELESTIA_NODE_AUTH_TOKEN</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{ &quot;id&quot;: 1, &quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;da.Submit&quot;, &quot;params&quot;: [[&quot;SGVsbG8gd28ybGQh&quot;], -1, &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAECAwQFBgcICRA=&quot;]}&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://127.0.0.1:26658</span></span></code></pre></div><p>Which should return:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">&quot;jsonrpc&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;2.0&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;result&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">&quot;9QEAAAAAAABmGvJUORYLqY8wVdjgp6/0oSh6brQqG3ZGr/cfUMuElg==&quot;</span><span style="color:#B392F0;">],</span><span style="color:#B392F0;">&quot;id&quot;</span><span style="color:#B392F0;">:1}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span><span style="color:#6F42C1;">&quot;jsonrpc&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;2.0&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;result&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;">[</span><span style="color:#6F42C1;">&quot;9QEAAAAAAABmGvJUORYLqY8wVdjgp6/0oSh6brQqG3ZGr/cfUMuElg==&quot;</span><span style="color:#6F42C1;">],</span><span style="color:#6F42C1;">&quot;id&quot;</span><span style="color:#6F42C1;">:1}</span></span></code></pre></div><p>Alternatively, you can shut off the light node and see that the OP Stack devnet logs show that the rollup has fallen back to the L1, in this case Ethereum, for posting data.</p><h2 id="span-batches" tabindex="-1">Span batches <a class="header-anchor" href="#span-batches" aria-label="Permalink to &quot;Span batches&quot;">​</a></h2><p>Span batches can be enabled by setting <code>OP_BATCHER_BATCH_TYPE: 1</code> in your <code>docker-compose.yml</code> file.</p><p>Note that this requires the Delta activation time to be configured. For your devnet, you should set <code>&quot;l2GenesisDeltaTimeOffset&quot;: &quot;0x0&quot;,</code> in <code>devnetL1-template.json</code>. This will enable span batches and can be tested by grepping <code>docker compose logs -f | grep batch_type</code> which should include <code>batch_type=SpanBatch</code> and <code>batch_type=1</code>.</p>`,61),sn=JSON.parse('{"title":"Run an OP Stack devnet posting Celestia","description":"Start your own devnet with a modified version of optimism-bedrock.","frontmatter":{"description":"Start your own devnet with a modified version of optimism-bedrock.","next":{"text":"Ethereum fallback mechanism","link":"/developers/ethereum-fallback"},"head":[["meta",{"name":"og:title","content":"Run an OP Stack devnet posting Celestia | Celestia Docs"},{"name":"og:description","content":false}]]},"headers":[],"relativePath":"developers/optimism.md","filePath":"developers/optimism.md","lastUpdated":1717430123000}'),Ya={name:"developers/optimism.md"},an=Object.assign(Ya,{setup(Wa){return(Xa,za)=>(t(),p("div",null,[c,s("div",r,[i,s("div",d,[E,s("div",y,[h,_,s("pre",u,[s("code",null,[s("span",b,[s("span",F,"$HOME/.celestia-light-"+e(l(o).mochaChainId)+"/config.toml",1)])])]),s("pre",C,[s("code",null,[s("span",g,[s("span",f,"$HOME/.celestia-light-"+e(l(o).mochaChainId)+"/config.toml",1)])])])]),s("div",T,[m,A,s("pre",v,[s("code",null,[s("span",k,[s("span",q,"$HOME/.celestia-light-"+e(l(o).arabicaChainId)+"/config.toml",1)])])]),s("pre",B,[s("code",null,[s("span",S,[s("span",D,"$HOME/.celestia-light-"+e(l(o).arabicaChainId)+"/config.toml",1)])])])])])]),P,s("div",I,[x,s("div",V,[N,s("div",w,[O,R,s("pre",H,[s("code",null,[s("span",M,[s("span",$,"$HOME/.celestia-light-"+e(l(o).mochaChainId),1)])])]),s("pre",L,[s("code",null,[s("span",U,[s("span",G,"$HOME/.celestia-light-"+e(l(o).mochaChainId),1)])])])]),s("div",j,[Q,K,s("pre",Y,[s("code",null,[s("span",W,[s("span",X,"$HOME/.celestia-light-"+e(l(o).arabicaChainId),1)])])]),s("pre",z,[s("code",null,[s("span",Z,[s("span",J,"$HOME/.celestia-light-"+e(l(o).arabicaChainId),1)])])])])])]),ss,s("div",as,[ns,s("div",os,[es,s("div",ls,[ts,ps,s("pre",cs,[s("code",null,[rs,a(`
`),is,a(`
`),ds,a(`
`),Es,a(`
`),ys,a(`
`),hs,a(`
`),_s,a(`
`),s("span",us,[bs,s("span",Fs,"$HOME/.celestia-light-"+e(l(o).mochaChainId)+"/:/home/celestia/.celestia-light-"+e(l(o).mochaChainId)+"/",1),Cs]),a(`
`),gs,a(`
`),fs,a(`
`),Ts,a(`
`),ms,a(`
`),As,a(`
`),vs,a(`
`),ks,a(`
`),qs,a(`
`),Bs,a(`
`),Ss])]),s("pre",Ds,[s("code",null,[Ps,a(`
`),Is,a(`
`),xs,a(`
`),Vs,a(`
`),Ns,a(`
`),ws,a(`
`),Os,a(`
`),s("span",Rs,[Hs,s("span",Ms,"$HOME/.celestia-light-"+e(l(o).mochaChainId)+"/:/home/celestia/.celestia-light-"+e(l(o).mochaChainId)+"/",1),$s]),a(`
`),Ls,a(`
`),Us,a(`
`),Gs,a(`
`),js,a(`
`),Qs,a(`
`),Ks,a(`
`),Ys,a(`
`),Ws,a(`
`),Xs,a(`
`),zs])])]),s("div",Zs,[Js,sa,s("pre",aa,[s("code",null,[na,a(`
`),oa,a(`
`),ea,a(`
`),la,a(`
`),ta,a(`
`),pa,a(`
`),ca,a(`
`),ra,a(`
`),s("span",ia,[da,s("span",Ea,"$HOME/.celestia-light-"+e(l(o).arabicaChainId)+"/:/home/celestia/.celestia-light-"+e(l(o).arabicaChainId)+"/",1),ya]),a(`
`),ha,a(`
`),_a,a(`
`),ua,a(`
`),ba,a(`
`),Fa,a(`
`),Ca,a(`
`),ga,a(`
`),fa,a(`
`),Ta,a(`
`),ma])]),s("pre",Aa,[s("code",null,[va,a(`
`),ka,a(`
`),qa,a(`
`),Ba,a(`
`),Sa,a(`
`),Da,a(`
`),Pa,a(`
`),Ia,a(`
`),s("span",xa,[Va,s("span",Na,"$HOME/.celestia-light-"+e(l(o).arabicaChainId)+"/:/home/celestia/.celestia-light-"+e(l(o).arabicaChainId)+"/",1),wa]),a(`
`),Oa,a(`
`),Ra,a(`
`),Ha,a(`
`),Ma,a(`
`),$a,a(`
`),La,a(`
`),Ua,a(`
`),Ga,a(`
`),ja,a(`
`),Qa])])])])]),Ka]))}});export{sn as __pageData,an as default};
